---
title             : "childes-db: a flexible and reproducible interface to the Child Language Data Exchange System"
shorttitle        : "childes-db: an interface to CHILDES"

author: 
  - name          : "Alessandro Sanchez*"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "sanchez7@stanford.edu"
  - name          : "Stephan Meylan*"
    affiliation   : "2"
  - name          : "Mika Braginsky"
    affiliation   : "3"
  - name          : "Kyle E. MacDonald"
    affiliation   : "1"
  - name          : "Daniel Yurovsky"
    affiliation   : "4"
  - name          : "Michael C. Frank"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "Stanford University"
  - id            : "2"
    institution   : "University of California, Berkeley"
  - id            : "3"
    institution   : "MIT"
  - id            : "4"
    institution   : "University of Chicago"

author_note: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  This work supported by a Jacobs Foundation Fellowship to MCF. 

abstract: |
  The Child Language Data Exchange System (CHILDES) has played a critical role in research on child language development. However, traditional methods of inquiry into the data have often relied on a command line interface to extract developmental indices or custom parsers to extract data for computational modeling. Now, advances in open-source software allow for novel approaches in working with this dataset. We introduce childes-db, a tool that improves data accessibility and usability by offering novel interfaces to CHILDES, including browsable web applications and an R application programming interface.  Along with a versioned infrastructure that facilitates reproduction of past analyses, these interfaces lower barriers to analyzing naturalistic parent-child language, allowing for a wider range of researchers in language and cognitive development to easily leverage “data from beyond the lab” in their work. 
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["childesdb.bib"]

figsintext        : no
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes

lang              : "english"
class             : "man"
output            : papaja::apa6_pdf
---

```{r load_packages, echo = FALSE, warning=FALSE}
library(papaja)
library(tidyverse)
library(childesr)
library(directlabels)
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
```

# Introduction

Children's language acquisition is a core puzzle in cognitive science. How are the representations underlying the generative use of language learned over children's first years? Because a language is comprised of many individual pieces of information -- the names of particular objects, the marker for the past tense, the position of determiners -- language development is fundamentally a question of learning from environmental input, which is the only source of information on these specifics. Further, children are often reluctant experimental participants; often their most revealing and most sophisticated uses of language emerge in naturalistic play. Thus, language acquisition research must be grounded in the ecological behavior of children, both their language input and their language production in context. 

The foundational resource for studies of language acquisition is recordings and transcripts of children. Starting with Roger Brown's [-@brown1973] foundational work on Adam, Eve, and Sarah, longitudinal recordings of children's talk (and the talk they hear from their caregivers) has formed the basis for this field. But creating individual transcripts is extremely hard work. Beyond gathering the data, even orthographic transcriptions (without phonetic detail) can take ten times the length of the original recording to transcribe. Thus, researchers' desire for data from multiple ages or multiple children can very quickly outstrip their resources. 

Established in 1984 to address this issue, the Child Language Data Exchange System (CHILDES) aims to make transcripts and recording of children's language available for researchers via a free resource [@macwhinney2000]. CHILDES archives tens of thousands of transcripts of children’s speech, making it an critical resource for characterizing children’s early productive language use as well as their language environment. As the first major effort to consolidate and share transcripts of child language, CHILDES has been a pioneer in the move to curate and disseminate large-scale behavioral datasets publicly. 

Since its inception, a tremendous corpus of research has made use of CHILDES data. Individual studies are too numerous to list, but  classics include studies of morphological over-regularization [@marcus1992], distributional learning [@redington1998], word segmentation [@goldwater2009], the role of frequency in word learning [@goodman2008] and many others. Some studies analyze individual examples in depth [e.g., @snyder2007] while others work with the corpus as a whole [e.g., @meylan2017]. These are just a few of the thousands of studies that take CHILDES corpora -- transcripts, annotations, and associated media -- as starting points. 

Yet there are some challenges working with CHILDES, both for students and for advanced users. For beginners with a lower level of technical experience, mastering the system can be tricky. The CHILDES ecosystem uses a special file format (CHAT), which is stored in a plain text format but includes structured annotations grouped into tiers (stored on separate lines) so that information about utterances can be stored with accompanying information such as the phonological or morphological structure of the utterance. These files are analyzed via by a command-line tool (CLAN) with a host of specific arguments that allow users to count word frequencies, compute statistics (e.g., mean length of utterance, or MLU). While this system is flexible and powerful, mastering the CHAT codes and the CLAN tool can be daunting to navigate for a beginner or student. These technical barriers decrease the ease of casual exploration by a novice researcher or in a classroom exercise.

On the opposite end of the spectrum, for data-oriented researchers who are interested in doing large-scale analyses of CHILDES, the current tools are also not ideal. CLAN software is an excellent tool for interactive exploration, but -- as a free-standing application -- can be tricky to build into a processing pipeline written in a modern analytic platform such as python or R. Thus, researchers who would like to ingest the entire corpus (or some large subset) into a computational analysis typically write their own parsers of the CHAT format to extract the subset of the data they would like to use [e.g., @redington1998,@yang2013,@meylan2017]. 

This practice is problematic for a number of reasons. Effort wasted in rewriting the same parser again and again. In addition, this process introduces a major source of errors and inconsistencies in data handling due to difficulties dealing with the many special cases in the CHAT standard. Further, these scripta are rarely shared, leading to much greater difficulty in reproducing the exact numerical results from papers using CHILDES [see e.g., @meylan2017]. This lack of computational reproducibility is widely recognized as problematic because it does not allow researchers to verify or build on published researcher [@donoho2010,@stodden2016]. Finally, the CHILDES corpus itself is a moving target;  computational work using the entire corpus at one time point may include a different set of data than subsequent work (due to new contributions or revisions). 

In the current manuscript, we describe a system for extending the functionality of CHILDES to address these issues. Our systemn, childes-db, is a database-formatted mirror of CHILDES that allows programmatic access through an application programming interface (API). This infrastructure allows the creation of web applications for browsing and visualizing the data easily, facilitating classroom use of the dataset. Further, it can be accessed programmatically by advanced researchers, obviating the need to write one-off parsers of the CHAT format. The database is versioned for access to previous images, allowing computational reproducibility of particular analyses.

We begin by describing the architecture of childes-db and the web applications that we provide. We next describe the `childesr` API, which allows for programmatic access to the data. We then present two worked examples of specific uses of the system using both the web app and the API. The first examines the frequency of color words in children's input; the second quantifies the growth of lexical diversity across genders. We end by presenting some suggestions for the use of the childes-db web frontend in classroom teaching. 

# The Architecture of childes-db

We first present the design and technical approach of childes-db, then describe the interactive analysis tools provided by our web-based frontend. 

## Design and technical approach

Unlike the *parsing* approach in CLAN which entails the sequential processing of strings, childes-db treats CHILDES as a set of linked tables, with records corresponding to intuitive abstractions such as words, utterances, and transcripts. Users of data analysis languages like R or Julia, libraries like Pandas, or those familiar with Structured Query Language (SQL) will be familiar with operations on tables such as filtering (subsetting), sorting, aggregation (grouping), and joins (merges). We expect most users to interact with the database through the `childesr` API for the `R` language described below, we begin with a top-level description and motivation for the design of the database schema, details of the database’s current technical implementation, and our versioning scheme.

At its core, childes-db is a database consisting of a set of linked tabular data stores where rows corresponding to records. The smallest unit of abstraction tracked by the database is a token, treated here as the citation orthographic form of a word. Using the standardized written form of the word facilitates the computation of lexical frequency statistics, for comparison or aggregation across children or time periods. Deviations from the citation form—reflecting the deviations from citation forms that are particularly common in the course of language development— are kept as a separate (possibly null) field associated with each token.

Other tables in the database comprise a hierarchical system of collections built on top of tokens—*utterance*, *transcription*, *corpus*, and *collection*—which stores attributes appropriate for each level of description. Every entity includes attributes that link it to all higher-order collections, e.g., an utterance lists the transcript, corpus, and collection to which it belongs.  An *utterance* contains one or more words and includes fields such as the utterance type (declarative, question, etc.), total number of tokens, and the total number one morphemes. [[ How are we handling the long tail of tiers?]]. A *transcription* consists of one or more utterances and includes the date collected, the name of the target child and age in days (if defined), and the filename from CHILDES. A *corpus* consists of one or more transcripts, corresponding to well-known collections like the Brown or Providence corpus. Finally, a *collection* is a superordinate collection of corpora generally corresponding to a geographic region, following the convention in CHILDES. Because every entity can be linked to a top-level collection, childes-db places content from all languages in the same table for a given level of abstraction.

We chose to treat participants separate from the above hierarchy because children can occur across transcripts (e.g., the Brown Corpus). A participant is associated with every word and utterance, including a name, role, 3-letter CHILDES identifier (CHI, MOT, FAT, etc.), and the range of ages (or age of corresponding child) for which they are observed. For non-child participants, the record contains an identifier for the target child to associate caregivers and children.

### Technical Implementation

The above tabular datastore is implemented as a MySQL database.  As an industry-standard, open-source relational database server, the above database can be accessed directly from a wide range of programming languages. The childes-db project provides hosted read-only databases for direct access and for `childesr` (described below) as well as compressed .sql exports for local installation. While the former is appropriate for casual users, local installation can provide performance gains (allowing a user to access the database on their local machine or on their network) as well as write support in case users wish to store derived information in the same database.

[[Details of extraction]]
[[Details of testing: Why trust our parse over your in-house library?]]

### Versioning

To reflect changes in the CHILDES database as new corpora are added or previous annotations revised, we produce a new versioned parse of the complete database every [[n]] months. By default, users connect to the most recent version. To support reproduction of results with previous versions of the database, we provide hosted versions of the last [[m]] versions so that researchers can refer to specific releases. Compressed .sql files are available for download for [[r]] years. 

## Interactive Analysis Tools

childes-db offers a collection of browser-based interactive visualizations that enable exploration of the data through easy-to-use interfaces that don’t require any programming knowledge. These tools are intended for casual users who seek to extract useful developmental indices from CHILDES without the technical overhead. The visualizations available are the following: Frequency Counts (for lexical usage statistics), MLU (to chart syntactic growth), and Population Viewer (to get a better understanding of the size of various corpora in the database). All three of these visualizations were built using Shiny, an R package that enables easy building of web applications in R. For each visualization, a user specifies a subset of the data, in particular the collection, corpus, child (target child in the session), and speaker (mother, father, etc.). The user may also restrict the age range of the child with slider bars. Any number of corpora, children, and speakers may be selected, allowing for aggregate counts across a whole range of data, a task that could not have been done with ease using previous methods. Along with the visualizations, childes-db makes the raw data itself available for download under a separate “Table” tab; this allows researchers to further explore and analyze the data they see in the plots.

### Frequency Counts

The Frequency Counts app allows users to enter a word in a text box and see the number of times this word was uttered across age for a particular subset of the data (in parts per million), whether it is an individual child in the Brown corpus or all Spanish speaking children and their mothers The ability to view the caregiver’s usage of a term alongside a child’s assists researchers in better understanding the relationship between input and uptake. Users can also plot word trajectories alongside each other (such as “mom” and “dad” or “front” and “back”) for convenient cross-word comparisons.

### MLU

MLU (mean length of utterance) is an important measure used to assess the syntactic complexity in children’s speech. The MLU app plots MLU curves across age for a given subset of data, again specified by collection, corpora, children, and speakers. Because of the underlying gaps in available CHILDES morphological data, MLUw (mean length of utterance in words) is computed and not MLUm (mean length of utterance in morphemes). In the English language, these two measures have been shown to be highly correlated. As with the Frequency Counts app, caregiver’s MLU can be plotted alongside children.

### Population Viewer

The population viewer is a tool that helps users understand the relative sizes of various corpora by displaying the total number of utterances or tokens in the available corpora at particular ages. In many instances the size of a given corpus may inform researchers’ decisions as to what is the best target dataset for analysis.


# The `childesr` Package

Although the interactive analysis tools described above cover some of the most common use cases of CHILDES data, researchers interested in more detailed and flexible analyses will want to interface directly with the data in childes-db. Making use of the `R` programming language [@R-base], we provide the `childesr` package to help researchers accomplish this task. `R` is an open-source, extensible statistical computing environment that is rapidly growing in popularity across fields and is increasing in use in child language research [e.g. @song2015; @norrman2015]. The `childesr` package abstracts away the details of connecting to the database. Users can take advantage of the tools developed in the popular `dplyr` package [@R-dplyr], which make manipulating large datasets quick and easy. We describe the commands that the package provides and then give several worked examples of using the package for analyses.


## Package Details

The `childesr` package is easily installed via CRAN, the comprehensive R archive network. To install, simply type: `install.packages("childesr")`. After installation, users have access to data loading functions that retrieve a variety of subsets of the data:

- `get_collections()` gives the names of available collections of corpora ("Eng-NA", "Spanish", etc.)
- `get_corpora()` gives the names of available corpora ("Brown", "Clark", etc.)
- `get_transcripts()` gives information on available transcripts (language, date, target child demographics)
- `get_participants()` gives information on transcript participants (name, role, demographics)
- `get_speaker_statistics()` gives summary statistics for each participant in each transcript (number of utterances, number of types, number of tokens, mean length of utterance)
- `get_utterances()` gives information on each utterance (glosses, stems, parts of speech, utterance type, number of tokens, number of morphemes, speaker information, target child information)
- `get_types()` gives information on each type within each transcript (gloss, count, speaker information, target child information)
- `get_tokens()` gives information on each token (gloss, stem, part of speech, number of morphemes, speaker information, target child information)

Each of these functions can be supplied with arguments that restrict the query to a particular subset of the data (e.g. by collection, by corpus, by speaker role, by target child age, etc.) For more detailed documentation, see the package repository (http://github.com/langcog/childesr).


## Worked Examples

### Color frequency 

One common use of the CHILDES corpora is estimating the frequency with which children hear different words. These frequency estimates are used both in the development of theory (e.g. frequent words are learned earlier; @goodman2008), and in the construction of age-appropriate experimental stimuli. One benefit of the childesdb interface is that it allows for easy analysis of how the frequency of words changes over development. Many of our theories in which children learn the structure of language from its statistical properties implicitly assume that these statistics are *stationary*, i.e. unchanging over development (e.g., @saffran1996). However a number of recent analysis show that the frequencies with which infants encounter both linguistic and visual properties of their environment may change dramattically over development [@fausey2016], and these changing distributions may produce similarly dramatic changes in the ease or difficulty with which these regularities can be learned [@elman1993].

To demonstrate how one might discover such a non-staionarity, we take as a case study the frequency with which children hear the color words of english (e.g. "blue", "green"). Color words tend to be learned relatively late by children, potentially in part due to the abstractness of the meanings to which they refer (see @wagner2013). However, within the set of color words, the frequency with which these words are heard predicts a significant fraction of the variance in their order of acquisition [@yurovsky2015]. But are these frequencies stationary--e.g. do children hear "blue" as often at 12 months as they do at 24 months? We answer this question in two ways--first using the childesb shiny apps, and then using the `childesr` package.

```{r}
colors <- c("black", "white", "red", "green", "yellow", "blue", "brown", 
             "orange", "pink", "purple")

graph_colors <- data_frame(color = colors,
                           graph_color = if_else(color == "white", 
                                                 "light gray", color))

color_counts <- get_types(role = c("Mother", "Father"), age = c(12,60), 
                              type = colors)


count_estimates <- color_counts %>%
  mutate(age = target_child_age / 30.5,
         age_bin = as.integer(floor(age / 6) * 6),
         color = tolower(gloss)) %>%
  group_by(age_bin, color, target_child_id) %>%
  summarise(count = sum(count)) %>%
  summarise(mean = mean(count, na.rm = T),
            sem = sd(count, na.rm = T) / sqrt(sum(!is.na(count)))) %>%
  left_join(graph_colors) %>%
  mutate(color = factor(color, levels = colors))


ggplot(count_estimates, aes(x = age_bin, y = mean, ymin = mean - sem, 
                            ymax = mean + sem, color = color, label = color)) + 
  geom_pointrange(position = position_dodge(.5)) + 
  geom_smooth(se = F) +
  facet_wrap(~ color) + 
  theme_classic(base_size = 14) +
  scale_color_manual(values = graph_colors$graph_color) +
  scale_x_continuous(breaks = seq(12, 60, 12),
                     name = "age (months)") + 
  geom_dl(method = list(dl.trans(x=x +.2), "last.qp", cex=1)) + 
  theme(legend.position = "none")
```



non-stationarity

### Gender

```{r warning=FALSE}
stats <- get_speaker_statistics(role = "Target_Child")

data <- stats %>%
  filter(!is.na(target_child_sex), language == "eng") %>%
  group_by(target_child_id, target_child_age, target_child_sex, language) %>%
  summarise(ttr = sum(num_types) / sum(num_tokens))

ggplot(data, aes(x = target_child_age, y = ttr, color = target_child_sex)) +
  geom_smooth()
```


# Teaching with childes-db

## Child-language class tutorials
## Data-science tutorials

# Conclusion

reiterate importance

# Acknowledgements
- Brian MacWhinney for CHILDES
- Melissa Kline for ClanToR


\newpage

# References
```{r create_r-references}
r_refs(file = "childesdb.bib")
```

\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
