---
title             : "childes-db: a flexible and reproducible interface to the Child Language Data Exchange System"
shorttitle        : "childes-db: an interface to CHILDES"

author: 
  - name          : "Alessandro Sanchez*"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "sanchez7@stanford.edu"
  - name          : "Stephan Meylan*"
    affiliation   : "2"
  - name          : "Mika Braginsky"
    affiliation   : "3"
  - name          : "Kyle E. MacDonald"
    affiliation   : "1"
  - name          : "Daniel Yurovsky"
    affiliation   : "4"
  - name          : "Michael C. Frank"
    affiliation   : "1"

affiliation:
  - id            : "1"
    institution   : "Stanford University"
  - id            : "2"
    institution   : "University of California, Berkeley"
  - id            : "3"
    institution   : "MIT"
  - id            : "4"
    institution   : "University of Chicago"

author_note: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  The Child Language Data Exchange System (CHILDES) has played a critical role in research on child language development. However, traditional methods of inquiry into the data have often relied on a command line interface to extract developmental indices or custom parsers to extract data for computational modeling. Now, advances in open-source software allow for novel approaches in working with this dataset. We introduce childes-db, a tool that improves data accessibility and usability by offering novel interfaces to CHILDES, including browsable web applications and an R application programming interface.  Along with a versioned infrastructure that facilitates reproduction of past analyses, these interfaces lower barriers to analyzing naturalistic parent-child language, allowing for a wider range of researchers in language and cognitive development to easily leverage “data from beyond the lab” in their work. 
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

figsintext        : no
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes

lang              : "english"
class             : "man"
output            : papaja::apa6_pdf
---

```{r load_packages, include = FALSE}
library(papaja)
library(tidyverse)
library(childesr)
library(directlabels)
knitr::opts_chunk$set(cache = TRUE)
```

# Introduction

Established in 1984, CHILDES archives tens of thousands of transcripts of children’s speech as well as that of their caregivers, making it an invaluable resource for characterizing children’s early productive language use as well as their language environment. Researchers have used the dataset for studies including estimating children’s latent vocabulary size, characterizing their lexical diversity, evaluating the prevalence of negative examples to children, and retrieving the frequencies of various syntactic constructions, among thousands of others. As the first major effort to consolidate and share transcripts of child language, CHILDES has been a pioneer in the move to curate and disseminate large-scale behavioral datasets publicly. 

Uses
Uptake
Intake
Theory / growing interest in child language growth (roger brown etc)
Why dataset is successful in light of theoretical interests discussed
Challenges working with CHILDES
Expanding the range of use cases (beginner / expert)
Pulling out for modeling: 
People write their own parsers/pipelines
Duplicated effort
Versioning and reproducibility
Can’t easily integrate clan calls with pipeline
Solution (childes-db)


At its core is a series of linked tabular data stores, currently implemented in `MySQL`, which can be accessed from dozens of programming languages. The second is an `R` package called `childesr` that provides abstractions for the most common complex queries, obviating the need to write `SQL`. `childesr` exposes preprocessed, tabular data from CHILDES through its application programming interface (API), providing researchers with the opportunity to exploit conveniently formatted data in a familiar programming environment. Finally, we provide  a collection of browser-based interactive applications that enable visual exploration of CHILDES, allowing researchers to easily view and download useful information from the corpus including mean length of utterance (MLU) and word frequency counts.


# The Architecture of childes-db

High level discussion of features

## Childes-db	

Unlike the *parsing* approach in CLAN which entails the sequential processing of strings, childes-db treats CHILDES as a set of linked tables, with records corresponding to intuitive abstractions such as words, utterances, and transcripts. Users of data analysis languages like R or Julia, libraries like Pandas, or those familiar with Structured Query Language (SQL) will be familiar with operations on tables such as filtering (subsetting), sorting, aggregation (grouping), and joins (merges). We expect most users to interact with the database through the `childesr` API for the `R` language described below, we begin with a top-level description and motivation for the design of the database schema, details of the database’s current technical implementation, and our versioning scheme.

At its core, childes-db is a database consisting of a set of linked tabular data stores where rows corresponding to records. The smallest unit of abstraction tracked by the database is a token, treated here as the citation orthographic form of a word. Using the standardized written form of the word facilitates the computation of lexical frequency statistics, for comparison or aggregation across children or time periods. Deviations from the citation form—reflecting the deviations from citation forms that are particularly common in the course of language development— are kept as a separate (possibly null) field associated with each token.

Other tables in the database comprise a hierarchical system of collections built on top of tokens—*utterance*, *transcription*, *corpus*, and *collection*—which stores attributes appropriate for each level of description. Every entity includes attributes that link it to all higher-order collections, e.g., an utterance lists the transcript, corpus, and collection to which it belongs.  An *utterance* contains one or more words and includes fields such as the utterance type (declarative, question, etc.), total number of tokens, and the total number one morphemes. [[ How are we handling the long tail of tiers?]]. A *transcription* consists of one or more utterances and includes the date collected, the name of the target child and age in days (if defined), and the filename from CHILDES. A *corpus* consists of one or more transcripts, corresponding to well-known collections like the Brown or Providence corpus. Finally, a *collection* is a superordinate collection of corpora generally corresponding to a geographic region, following the convention in CHILDES. Because every entity can be linked to a top-level collection, childes-db places content from all languages in the same table for a given level of abstraction.

We chose to treat participants separate from the above hierarchy because children can occur across transcripts (e.g., the Brown Corpus). A participant is associated with every word and utterance, including a name, role, 3-letter CHILDES identifier (CHI, MOT, FAT, etc.), and the range of ages (or age of corresponding child) for which they are observed. For non-child participants, the record contains an identifier for the target child to associate caregivers and children.
Technical Implementation

The above tabular datastore is implemented as a MySQL database.  As an industry-standard, open-source relational database server, the above database can be accessed directly from a wide range of programming languages. The childes-db project provides hosted read-only databases for direct access and for `childesr` (described below) as well as compressed .sql exports for local installation. While the former is appropriate for casual users, local installation can provide performance gains (allowing a user to access the database on their local machine or on their network) as well as write support in case users wish to store derived information in the same database.

## Interactive Analysis Tools

childes-db offers a collection of browser-based interactive visualizations that enable exploration of the data through easy-to-use interfaces that don’t require any programming knowledge. These tools are intended for casual users who seek to extract useful developmental indices from CHILDES without the technical overhead. The visualizations available are the following: Frequency Counts (for lexical usage statistics), MLU (to chart syntactic growth), and Population Viewer (to get a better understanding of the size of various corpora in the database). All three of these visualizations were built using Shiny, an R package that enables easy building of web applications in R. For each visualization, a user specifies a subset of the data, in particular the collection, corpus, child (target child in the session), and speaker (mother, father, etc.). The user may also restrict the age range of the child with slider bars. Any number of corpora, children, and speakers may be selected, allowing for aggregate counts across a whole range of data, a task that could not have been done with ease using previous methods. Along with the visualizations, childes-db makes the raw data itself available for download under a separate “Table” tab; this allows researchers to further explore and analyze the data they see in the plots.

### Frequency Counts

The Frequency Counts app allows users to enter a word in a text box and see the number of times this word was uttered across age for a particular subset of the data (in parts per million), whether it is an individual child in the Brown corpus or all Spanish speaking children and their mothers The ability to view the caregiver’s usage of a term alongside a child’s assists researchers in better understanding the relationship between input and uptake. Users can also plot word trajectories alongside each other (such as “mom” and “dad” or “front” and “back”) for convenient cross-word comparisons.

### MLU

MLU (mean length of utterance) is an important measure used to assess the syntactic complexity in children’s speech. The MLU app plots MLU curves across age for a given subset of data, again specified by collection, corpora, children, and speakers. Because of the underlying gaps in available CHILDES morphological data, MLUw (mean length of utterance in words) is computed and not MLUm (mean length of utterance in morphemes). In the English language, these two measures have been shown to be highly correlated. As with the Frequency Counts app, caregiver’s MLU can be plotted alongside children.

### Population Viewer

The population viewer is a tool that helps users understand the relative sizes of various corpora by displaying the total number of utterances or tokens in the available corpora at particular ages. In many instances the size of a given corpus may inform researchers’ decisions as to what is the best target dataset for analysis.


# The `childesr` Package

Although the interactive analysis tools described above cover some of the most common use cases of CHILDES data, researchers interested in more detailed and flexible analyses will want to interface directly with the data in childes-db. Making use of the `R` programming language [@R-base], we provide the `childesr` package to help researchers accomplish this task. `R` is an open-source, extensible statistical computing environment that is rapidly growing in popularity across fields and is increasing in use in child language research [e.g. @song2015; @norrman2015]. The `childesr` package abstracts away the details of connecting to the database. Users can take advantage of the tools developed in the popular `dplyr` package [@R-dplyr], which make manipulating large datasets quick and easy. We describe the commands that the package provides and then give several worked examples of using the package for analyses.


## Package Details

The `childesr` package is easily installed via CRAN, the comprehensive R archive network. To install, simply type: `install.packages("childesr")`. After installation, users have access to data loading functions that retrieve a variety of subsets of the data:

- `get_collections()` gives the names of available collections of corpora ("Eng-NA", "Spanish", etc.)
- `get_corpora()` gives the names of available corpora ("Brown", "Clark", etc.)
- `get_transcripts()` gives information on available transcripts (language, date, target child demographics)
- `get_participants()` gives information on transcript participants (name, role, demographics)
- `get_speaker_statistics()` gives summary statistics for each participant in each transcript (number of utterances, number of types, number of tokens, mean length of utterance)
- `get_utterances()` gives information on each utterance (glosses, stems, parts of speech, utterance type, number of tokens, number of morphemes, speaker information, target child information)
- `get_types()` gives information on each type within each transcript (gloss, count, speaker information, target child information)
- `get_tokens()` gives information on each token (gloss, stem, part of speech, number of morphemes, speaker information, target child information)

Each of these functions can be supplied with arguments that restrict the query to a particular subset of the data (e.g. by collection, by corpus, by speaker role, by target child age, etc.) For more detailed documentation, see the package repository (http://github.com/langcog/childesr).


## Worked Examples

### Color frequency 

```{r}
colors <- c("black", "white", "red", "green", "yellow", "blue", "brown", 
             "orange", "pink", "purple")

graph_colors <- data_frame(color = colors,
                           graph_color = if_else(color == "white", 
                                                 "light gray", color))

color_counts <- get_types(role = c("Mother", "Father"), age = c(12,60), 
                              type = colors)


count_estimates <- color_counts %>%
  mutate(age = target_child_age / 30.5,
         age_bin = as.integer(floor(age / 6) * 6),
         color = tolower(gloss)) %>%
  group_by(age_bin, color, target_child_id) %>%
  summarise(count = sum(count)) %>%
  summarise(mean = mean(count, na.rm = T),
            sem = sd(count, na.rm = T) / sqrt(sum(!is.na(count)))) %>%
  left_join(graph_colors)


ggplot(count_estimates, aes(x = age_bin, y = mean, ymin = mean - sem, 
                            ymax = mean + sem, color = color, label = color)) + 
  geom_pointrange(position = position_dodge(.5)) + 
  geom_smooth(se = F) +
  facet_wrap(~ color) + 
  theme_classic(base_size = 14) +
  scale_color_manual(values = graph_colors$graph_color) +
  scale_x_continuous(breaks = seq(12, 60, 6)) + 
  geom_dl(method = list(dl.trans(x=x +.2), "last.qp", cex=1)) + 
  theme(legend.position = "none")
```



non-stationarity

### Gender

```{r}
stats <- get_speaker_statistics(role = "Target_Child")

data <- stats %>%
  filter(!is.na(target_child_sex), collection_name == "Eng-NA") %>%
  group_by(target_child_id, target_child_age, target_child_sex, language) %>%
  summarise(ttr = sum(num_types) / sum(num_tokens))

ggplot(data, aes(x = target_child_age, y = ttr, color = target_child_sex)) +
  geom_smooth()
```


# Teaching with childes-db

## Child-language class tutorials
## Data-science tutorials

# Conclusion

reiterate importance


\newpage

# References
```{r create_r-references}
r_refs(file = "childesd.bib")
```

\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
